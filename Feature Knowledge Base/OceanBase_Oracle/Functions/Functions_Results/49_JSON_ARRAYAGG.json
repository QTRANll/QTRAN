{
    "HTML": [
        "https://www.oceanbase.com/docs/enterprise-oceanbase-database-cn-1000000000823494"
    ],
    "Title": [
        "JSON_ARRAYAGG"
    ],
    "Feature": [
        "JSON_ARRAYAGG(expr [FORMAT JSON]\n                   [ORDER SIBLINGS BY order_condition]\n                   [ABSENT|NULL ON NULL,]\n                   [RETURNING  CLOB|BLOB|JSON|VARCHAR2|VARCHAR2[size],]\n                   [STRICT]);\n"
    ],
    "Description": [
        "JSON_ARRAYAGG() 是一个聚合函数，它将所有列的数据转换成 JSON 数据，并且将所有的 JSON 数据组成一个单独的 JSON 数组结构。"
    ],
    "Examples": [
        "# 使用默认参数\nobclient> CREATE TABLE id_table (id NUMBER);\nobclient> INSERT INTO id_table VALUES(624);\nobclient> INSERT INTO id_table VALUES(null);\nobclient> INSERT INTO id_table VALUES(925);\nobclient> INSERT INTO id_table VALUES(585);\nobclient> SELECT JSON_ARRAYAGG(id) ID_NUMBERS FROM id_table;\n+---------------+\n| ID_NUMBERS    |\n+---------------+\n| [624,925,585] |\n+---------------+\n1 row in set\n\n# 使用FORMAT JSON 子句\nobclient> CREATE TABLE json_table (json_doc VARCHAR2(100))\nobclient> INSERT INTO json_table VALUES('[1]');\nobclient> INSERT INTO json_table VALUES('[1,2]');\nobclient> INSERT INTO json_table VALUES('[1,2,3]')\nobclient> INSERT INTO json_table VALUES('{key:\"value\"}');\nobclient> SELECT JSON_ARRAYAGG(json_doc FORMAT JSON) FROM json_table;\n+-----------------------------------+\n| JSON_ARRAYAGG(JSON_DOCFORMATJSON) |\n+-----------------------------------+\n| [[1],[1,2],[1,2,3],{key:\"value\"}] |\n+-----------------------------------+\n1 row in set\n\n# 使用 ABSENT ON NULL 子句\nobclient> SELECT JSON_ARRAYAGG(id ORDER BY id ABSENT ON NULL) FROM id_table;\n+----------------------------------------+\n| JSON_ARRAYAGG(IDORDERBYIDABSENTONNULL) |\n+----------------------------------------+\n| [585,624,925]                          |\n+----------------------------------------+\n1 row in set\n\n# 使用 ORDER BY 子句\nCREATE TABLE json_table (id NUMBER, text_data VARCHAR2(10), json_data JSON);\nINSERT INTO json_table VALUES(624, 'test1', '[1]');\nINSERT INTO json_table VALUES(null, 'test4', '[2]');\nINSERT INTO json_table VALUES(925, 'test2', '[3]');\nINSERT INTO json_table VALUES(585, 'test5', '[4]');\nINSERT INTO json_table VALUES(585, 'test3', '[5]');\nobclient> SELECT JSON_ARRAYAGG(text_data ORDER BY text_data) FROM json_table;\n+-------------------------------------------+\n| JSON_ARRAYAGG(TEXT_DATAORDERBYTEXT_DATA)  |\n+-------------------------------------------+\n| [\"test1\",\"test2\",\"test3\",\"test4\",\"test5\"] |\n+-------------------------------------------+\n1 row in set\n\nobclient> SELECT JSON_ARRAYAGG(text_data ORDER BY id) FROM json_table;\n+-------------------------------------------+\n| JSON_ARRAYAGG(TEXT_DATAORDERBYID)         |\n+-------------------------------------------+\n| [\"test5\",\"test3\",\"test1\",\"test2\",\"test4\"] |\n+-------------------------------------------+\n1 row in set\n\nobclient> SELECT JSON_ARRAYAGG(text_data ORDER BY id,text_data) FROM json_table;\n+---------------------------------------------+\n| JSON_ARRAYAGG(TEXT_DATAORDERBYID,TEXT_DATA) |\n+---------------------------------------------+\n| [\"test3\",\"test5\",\"test1\",\"test2\",\"test4\"]   |\n+---------------------------------------------+\n1 row in set\n\n# 使用 STRICT 子句\nCREATE TABLE json_table (json_doc VARCHAR2(100));\nINSERT INTO json_table VALUES('[1]');\nINSERT INTO json_table VALUES('[1,2]');\nINSERT INTO json_table VALUES('[1,2,3]');\nINSERT INTO json_table VALUES('{key:\"value\"}');\n\nobclient> SELECT JSON_ARRAYAGG(json_doc FORMAT JSON STRICT) ID_NUMBERS FROM json_table;\nORA-00600: Invalid JSON text.\nobclient> SELECT JSON_ARRAYAGG(json_doc FORMAT JSON) ID_NUMBERS FROM json_table;\n+-----------------------------------+\n| ID_NUMBERS                        |\n+-----------------------------------+\n| [[1],[1,2],[1,2,3],{key:\"value\"}] |\n+-----------------------------------+\n1 row in set\n\n"
    ],
    "Category": [
        "JSON Functions"
    ]
}