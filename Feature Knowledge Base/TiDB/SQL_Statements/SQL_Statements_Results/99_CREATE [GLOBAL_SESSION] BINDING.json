{
    "HTML": [
        "https://docs.pingcap.com//zh/tidb/stable/sql-statement-create-binding"
    ],
    "Title": [
        "CREATE [GLOBAL|SESSION] BINDING"
    ],
    "Feature": [
        "CreateBindingStmt ::=\n    'CREATE' GlobalScope 'BINDING' ( 'FOR' BindableStmt 'USING' BindableStmt\n|   'FROM' 'HISTORY' 'USING' 'PLAN' 'DIGEST' PlanDigest )\n\nGlobalScope ::=\n    ( 'GLOBAL' | 'SESSION' )?\n\nBindableStmt ::=\n    ( SelectStmt | UpdateStmt | InsertIntoStmt | ReplaceIntoStmt | DeleteStmt )\n"
    ],
    "Description": [
        "CREATE [GLOBAL|SESSION] BINDING \u8bed\u53e5\u7528\u4e8e\u5728 TiDB \u4e2d\u521b\u5efa\u65b0\u7684\u6267\u884c\u8ba1\u5212\u7ed1\u5b9a\u3002\u7ed1\u5b9a\u53ef\u7528\u4e8e\u5c06\u4f18\u5316\u5668 Hint \u63d2\u5165\u8bed\u53e5\u4e2d\uff0c\u800c\u65e0\u9700\u66f4\u6539\u5e95\u5c42\u67e5\u8be2\u3002",
        "BINDING \u8bed\u53e5\u53ef\u4ee5\u5728 GLOBAL \u6216\u8005 SESSION \u4f5c\u7528\u57df\u5185\u521b\u5efa\u6267\u884c\u8ba1\u5212\u7ed1\u5b9a\u3002\u5728\u4e0d\u6307\u5b9a\u4f5c\u7528\u57df\u65f6\uff0c\u9ed8\u8ba4\u7684\u4f5c\u7528\u57df\u4e3a SESSION\u3002",
        "\u88ab\u7ed1\u5b9a\u7684 SQL \u8bed\u53e5\u4f1a\u88ab\u53c2\u6570\u5316\u540e\u5b58\u50a8\u5230\u7cfb\u7edf\u8868\u4e2d\u3002\u5728\u5904\u7406 SQL \u67e5\u8be2\u65f6\uff0c\u53ea\u8981\u53c2\u6570\u5316\u540e\u7684 SQL \u8bed\u53e5\u548c\u7cfb\u7edf\u8868\u4e2d\u67d0\u4e2a\u88ab\u7ed1\u5b9a\u7684 SQL \u8bed\u53e5\u4e00\u81f4\uff0c\u5e76\u4e14\u7cfb\u7edf\u53d8\u91cf tidb_use_plan_baselines \u7684\u503c\u4e3a ON\uff08\u5176\u9ed8\u8ba4\u503c\u4e3a ON\uff09\uff0c\u5373\u53ef\u4f7f\u7528\u76f8\u5e94\u7684\u4f18\u5316\u5668 Hint\u3002\u5982\u679c\u5b58\u5728\u591a\u4e2a\u53ef\u5339\u914d\u7684\u6267\u884c\u8ba1\u5212\uff0c\u4f18\u5316\u5668\u4f1a\u4ece\u4e2d\u9009\u62e9\u4ee3\u4ef7\u6700\u5c0f\u7684\u4e00\u4e2a\u8fdb\u884c\u7ed1\u5b9a\u3002\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u8003\u521b\u5efa\u7ed1\u5b9a\u3002"
    ],
    "Examples": [
        "CREATE TABLE t1 (\n    id INT NOT NULL PRIMARY KEY auto_increment,\n    b INT NOT NULL,\n    pad VARBINARY(255),\n    INDEX(b)\n   );\nQuery OK, 0 rows affected (0.07 sec)\n\nINSERT INTO t1 SELECT NULL, FLOOR(RAND()*1000), RANDOM_BYTES(255) FROM dual;\nQuery OK, 1 row affected (0.01 sec)\nRecords: 1  Duplicates: 0  Warnings: 0\n\nINSERT INTO t1 SELECT NULL, FLOOR(RAND()*1000), RANDOM_BYTES(255) FROM t1 a JOIN t1 b JOIN t1 c LIMIT 100000;\nQuery OK, 1 row affected (0.00 sec)\nRecords: 1  Duplicates: 0  Warnings: 0\n\nINSERT INTO t1 SELECT NULL, FLOOR(RAND()*1000), RANDOM_BYTES(255) FROM t1 a JOIN t1 b JOIN t1 c LIMIT 100000;\nQuery OK, 8 rows affected (0.00 sec)\nRecords: 8  Duplicates: 0  Warnings: 0\n\nINSERT INTO t1 SELECT NULL, FLOOR(RAND()*1000), RANDOM_BYTES(255) FROM t1 a JOIN t1 b JOIN t1 c LIMIT 100000;\nQuery OK, 1000 rows affected (0.04 sec)\nRecords: 1000  Duplicates: 0  Warnings: 0\n\nINSERT INTO t1 SELECT NULL, FLOOR(RAND()*1000), RANDOM_BYTES(255) FROM t1 a JOIN t1 b JOIN t1 c LIMIT 100000;\nQuery OK, 100000 rows affected (1.74 sec)\nRecords: 100000  Duplicates: 0  Warnings: 0\n\nINSERT INTO t1 SELECT NULL, FLOOR(RAND()*1000), RANDOM_BYTES(255) FROM t1 a JOIN t1 b JOIN t1 c LIMIT 100000;\nQuery OK, 100000 rows affected (2.15 sec)\nRecords: 100000  Duplicates: 0  Warnings: 0\n\nINSERT INTO t1 SELECT NULL, FLOOR(RAND()*1000), RANDOM_BYTES(255) FROM t1 a JOIN t1 b JOIN t1 c LIMIT 100000;\nQuery OK, 100000 rows affected (2.64 sec)\nRecords: 100000  Duplicates: 0  Warnings: 0\n\nSELECT SLEEP(1);\n+----------+\n| SLEEP(1) |\n+----------+\n|        0 |\n+----------+\n1 row in set (1.00 sec)\n\nANALYZE TABLE t1;\nQuery OK, 0 rows affected (1.33 sec)\n\nEXPLAIN ANALYZE SELECT * FROM t1 WHERE b = 123;\n+-------------------------------+---------+---------+-----------+----------------------+---------------------------------------------------------------------------+-----------------------------------+----------------+------+\n| id                            | estRows | actRows | task      | access object        | execution info                                                            | operator info                     | memory         | disk |\n+-------------------------------+---------+---------+-----------+----------------------+---------------------------------------------------------------------------+-----------------------------------+----------------+------+\n| IndexLookUp_10                | 583.00  | 297     | root      |                      | time:10.545072ms, loops:2, rpc num: 1, rpc time:398.359\u00b5s, proc keys:297  |                                   | 109.1484375 KB | N/A  |\n| \u251c\u2500IndexRangeScan_8(Build)     | 583.00  | 297     | cop[tikv] | table:t1, index:b(b) | time:0s, loops:4                                                          | range:[123,123], keep order:false | N/A            | N/A  |\n| \u2514\u2500TableRowIDScan_9(Probe)     | 583.00  | 297     | cop[tikv] | table:t1             | time:12ms, loops:4                                                        | keep order:false                  | N/A            | N/A  |\n+-------------------------------+---------+---------+-----------+----------------------+---------------------------------------------------------------------------+-----------------------------------+----------------+------+\n3 rows in set (0.02 sec)\n\nCREATE SESSION BINDING FOR\n    SELECT * FROM t1 WHERE b = 123\n   USING\n    SELECT * FROM t1 IGNORE INDEX (b) WHERE b = 123;\nQuery OK, 0 rows affected (0.00 sec)\n\nEXPLAIN ANALYZE  SELECT * FROM t1 WHERE b = 123;\n+-------------------------+-----------+---------+-----------+---------------+--------------------------------------------------------------------------------+--------------------+---------------+------+\n| id                      | estRows   | actRows | task      | access object | execution info                                                                 | operator info      | memory        | disk |\n+-------------------------+-----------+---------+-----------+---------------+--------------------------------------------------------------------------------+--------------------+---------------+------+\n| TableReader_7           | 583.00    | 297     | root      |               | time:222.32506ms, loops:2, rpc num: 1, rpc time:222.078952ms, proc keys:301010 | data:Selection_6   | 88.6640625 KB | N/A  |\n| \u2514\u2500Selection_6           | 583.00    | 297     | cop[tikv] |               | time:224ms, loops:298                                                          | eq(test.t1.b, 123) | N/A           | N/A  |\n|   \u2514\u2500TableFullScan_5     | 301010.00 | 301010  | cop[tikv] | table:t1      | time:220ms, loops:298                                                          | keep order:false   | N/A           | N/A  |\n+-------------------------+-----------+---------+-----------+---------------+--------------------------------------------------------------------------------+--------------------+---------------+------+\n3 rows in set (0.22 sec)\n\nSHOW SESSION BINDINGS\\G\n*************************** 1. row ***************************\nOriginal_sql: select * from t1 where b = ?\n    Bind_sql: SELECT * FROM t1 IGNORE INDEX (b) WHERE b = 123\n  Default_db: test\n      Status: using\n Create_time: 2020-05-22 14:38:03.456\n Update_time: 2020-05-22 14:38:03.456\n     Charset: utf8mb4\n   Collation: utf8mb4_0900_ai_ci\n1 row in set (0.00 sec)\n\nDROP SESSION BINDING FOR SELECT * FROM t1 WHERE b = 123;\nQuery OK, 0 rows affected (0.00 sec)\n\nEXPLAIN ANALYZE  SELECT * FROM t1 WHERE b = 123;\n+-------------------------------+---------+---------+-----------+----------------------+-------------------------------------------------------------------------+-----------------------------------+----------------+------+\n| id                            | estRows | actRows | task      | access object        | execution info                                                          | operator info                     | memory         | disk |\n+-------------------------------+---------+---------+-----------+----------------------+-------------------------------------------------------------------------+-----------------------------------+----------------+------+\n| IndexLookUp_10                | 583.00  | 297     | root      |                      | time:5.31206ms, loops:2, rpc num: 1, rpc time:665.927\u00b5s, proc keys:297  |                                   | 109.1484375 KB | N/A  |\n| \u251c\u2500IndexRangeScan_8(Build)     | 583.00  | 297     | cop[tikv] | table:t1, index:b(b) | time:0s, loops:4                                                        | range:[123,123], keep order:false | N/A            | N/A  |\n| \u2514\u2500TableRowIDScan_9(Probe)     | 583.00  | 297     | cop[tikv] | table:t1             | time:0s, loops:4                                                        | keep order:false                  | N/A            | N/A  |\n+-------------------------------+---------+---------+-----------+----------------------+-------------------------------------------------------------------------+-----------------------------------+----------------+------+\n3 rows in set (0.01 sec)\n",
        "mysql> CREATE TABLE t(id INT PRIMARY KEY , a INT, KEY(a));\nQuery OK, 0 rows affected (0.06 sec)\n\nmysql> SELECT /*+ IGNORE_INDEX(t, a) */ * FROM t WHERE a = 1;\nEmpty set (0.01 sec)\n\nmysql> SELECT plan_digest FROM INFORMATION_SCHEMA.STATEMENTS_SUMMARY WHERE QUERY_SAMPLE_TEXT = 'SELECT /*+ IGNORE_INDEX(t, a) */ * FROM t WHERE a = 1';\n+------------------------------------------------------------------+\n| plan_digest                                                      |\n+------------------------------------------------------------------+\n| 4e3159169cc63c14b139a4e7d72eae1759875c9a9581f94bb2079aae961189cb |\n+------------------------------------------------------------------+\n1 row in set (0.01 sec)\n\nmysql> CREATE BINDING FROM HISTORY USING PLAN DIGEST '4e3159169cc63c14b139a4e7d72eae1759875c9a9581f94bb2079aae961189cb';\nQuery OK, 0 rows affected (0.02 sec)\n\nmysql> SELECT * FROM t WHERE a = 1;\nEmpty set (0.01 sec)\n\nmysql> SELECT @@LAST_PLAN_FROM_BINDING;\n+--------------------------+\n| @@LAST_PLAN_FROM_BINDING |\n+--------------------------+\n|                        1 |\n+--------------------------+\n1 row in set (0.01 sec)\n\n"
    ],
    "Category": [
        "\u7edf\u8ba1\u4fe1\u606f\u548c\u6267\u884c\u8ba1\u5212\u7ba1\u7406"
    ]
}