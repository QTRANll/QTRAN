{
    "HTML": [
        "https://docs.pingcap.com//zh/tidb/stable/sql-statement-lock-stats"
    ],
    "Title": [
        "LOCK STATS"
    ],
    "Feature": [
        "LockStatsStmt ::=\n    'LOCK' 'STATS' (TableNameList) | (TableName 'PARTITION' PartitionNameList)\n\nTableNameList ::=\n    TableName (',' TableName)*\n\nTableName ::=\n    Identifier ( '.' Identifier )?\n\nPartitionNameList ::=\n    Identifier ( ',' Identifier )*\n"
    ],
    "Description": [
        "LOCK STATS \u8bed\u53e5\u7528\u4e8e\u9501\u5b9a\u8868\u6216\u5206\u533a\u7684\u7edf\u8ba1\u4fe1\u606f\uff0c\u4f7f\u5f97\u5728\u9501\u5b9a\u671f\u95f4\uff0cTiDB \u4e0d\u4f1a\u81ea\u52a8\u66f4\u65b0\u7edf\u8ba1\u4fe1\u606f\u3002\u5177\u4f53\u884c\u4e3a\u8bf7\u53c2\u89c1\u9501\u5b9a\u7edf\u8ba1\u4fe1\u606f\u7684\u884c\u4e3a\u8bf4\u660e\u3002"
    ],
    "Examples": [
        "mysql> CREATE TABLE t(a INT, b INT);\nQuery OK, 0 rows affected (0.03 sec)\n\nmysql> INSERT INTO t VALUES (1,2), (3,4), (5,6), (7,8);\nQuery OK, 4 rows affected (0.00 sec)\nRecords: 4  Duplicates: 0  Warnings: 0\n\nmysql> ANALYZE TABLE t;\nQuery OK, 0 rows affected, 1 warning (0.02 sec)\n\nmysql> SHOW WARNINGS;\n+-------+------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Level | Code | Message                                                                                                                                                                                                               |\n+-------+------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Note  | 1105 | Analyze use auto adjusted sample rate 1.000000 for table test.t, reason to use this rate is \"Row count in stats_meta is much smaller compared with the row count got by PD, use min(1, 15000/4) as the sample-rate=1\" |\n+-------+------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n1 row in set (0.00 sec)\n",
        "mysql> LOCK STATS t;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> SHOW STATS_LOCKED;\n+---------+------------+----------------+--------+\n| Db_name | Table_name | Partition_name | Status |\n+---------+------------+----------------+--------+\n| test    | t          |                | locked |\n+---------+------------+----------------+--------+\n1 row in set (0.01 sec)\n\nmysql> ANALYZE TABLE t;\nQuery OK, 0 rows affected, 2 warnings (0.00 sec)\n\nmysql> SHOW WARNINGS;\n+---------+------+-----------------------------------------------------------------------------------------------------------------------------------------+\n| Level   | Code | Message                                                                                                                                 |\n+---------+------+-----------------------------------------------------------------------------------------------------------------------------------------+\n| Note    | 1105 | Analyze use auto adjusted sample rate 1.000000 for table test.t, reason to use this rate is \"use min(1, 110000/8) as the sample-rate=1\" |\n| Warning | 1105 | skip analyze locked table: test.t                                                                                                       |\n+---------+------+-----------------------------------------------------------------------------------------------------------------------------------------+\n2 rows in set (0.00 sec)\n",
        "mysql> CREATE TABLE t(a INT, b INT) PARTITION BY RANGE (a) (PARTITION p0 VALUES LESS THAN (10), PARTITION p1 VALUES LESS THAN (20), PARTITION p2 VALUES LESS THAN (30));\nQuery OK, 0 rows affected (0.03 sec)\n\nmysql> INSERT INTO t VALUES (1,2), (3,4), (5,6), (7,8);\nQuery OK, 4 rows affected (0.00 sec)\nRecords: 4  Duplicates: 0  Warnings: 0\n\nmysql> ANALYZE TABLE t;\nQuery OK, 0 rows affected, 6 warning (0.02 sec)\n\nmysql> SHOW WARNINGS;\n+---------+------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Level   | Code | Message                                                                                                                                                                                                                              |\n+---------+------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Warning | 1105 | disable dynamic pruning due to t has no global stats                                                                                                                                                                                 |\n| Note    | 1105 | Analyze use auto adjusted sample rate 1.000000 for table test.t's partition p0, reason to use this rate is \"Row count in stats_meta is much smaller compared with the row count got by PD, use min(1, 15000/4) as the sample-rate=1\" |\n| Warning | 1105 | disable dynamic pruning due to t has no global stats                                                                                                                                                                                 |\n| Note    | 1105 | Analyze use auto adjusted sample rate 1.000000 for table test.t's partition p1, reason to use this rate is \"TiDB assumes that the table is empty, use sample-rate=1\"                                                                 |\n| Warning | 1105 | disable dynamic pruning due to t has no global stats                                                                                                                                                                                 |\n| Note    | 1105 | Analyze use auto adjusted sample rate 1.000000 for table test.t's partition p2, reason to use this rate is \"TiDB assumes that the table is empty, use sample-rate=1\"                                                                 |\n+---------+------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n6 rows in set (0.01 sec)\n",
        "mysql> LOCK STATS t PARTITION p1;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> SHOW STATS_LOCKED;\n+---------+------------+----------------+--------+\n| Db_name | Table_name | Partition_name | Status |\n+---------+------------+----------------+--------+\n| test    | t          | p1             | locked |\n+---------+------------+----------------+--------+\n1 row in set (0.00 sec)\n\nmysql> ANALYZE TABLE t PARTITION p1;\nQuery OK, 0 rows affected, 2 warnings (0.01 sec)\n\nmysql> SHOW WARNINGS;\n+---------+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Level   | Code | Message                                                                                                                                                              |\n+---------+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Note    | 1105 | Analyze use auto adjusted sample rate 1.000000 for table test.t's partition p1, reason to use this rate is \"TiDB assumes that the table is empty, use sample-rate=1\" |\n| Warning | 1105 | skip analyze locked table: test.t partition (p1)                                                                                                                     |\n+---------+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n2 rows in set (0.00 sec)\n"
    ],
    "Category": [
        "\u9501\u5b9a\u8bed\u53e5"
    ]
}