{
    "HTML": [
        "https://dev.mysql.com/doc/refman/8.4/en/create-table-gipks.html"
    ],
    "Title": [
        "15.1.20.11 Generated Invisible Primary Keys"
    ],
    "Feature": [
        "mysql> SHOW CREATE TABLE auto_0\\G\n*************************** 1. row ***************************\n       Table: auto_0\nCreate Table: CREATE TABLE `auto_0` (\n  `c1` varchar(50) DEFAULT NULL,\n  `c2` int DEFAULT NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci\n1 row in set (0.00 sec)\n\nmysql> SHOW CREATE TABLE auto_1\\G\n*************************** 1. row ***************************\n       Table: auto_1\nCreate Table: CREATE TABLE `auto_1` (\n  `my_row_id` bigint unsigned NOT NULL AUTO_INCREMENT /*!80023 INVISIBLE */,\n  `c1` varchar(50) DEFAULT NULL,\n  `c2` int DEFAULT NULL,\n  PRIMARY KEY (`my_row_id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci\n1 row in set (0.00 sec)"
    ],
    "Description": [
        "\n        MySQL 8.4 supports generated invisible primary keys\n        for any InnoDB table that is\n        created without an explicit primary key. When the\n        sql_generate_invisible_primary_key\n        server system variable is set to ON, the\n        MySQL server automatically adds a generated invisible primary\n        key (GIPK) to any such table. This setting has no effect on\n        tables created using any other storage engine than\n        InnoDB.\n      ",
        "\n        By default, the value of\n        sql_generate_invisible_primary_key is\n        OFF, meaning that the automatic addition of\n        GIPKs is disabled. To illustrate how this affects table\n        creation, we begin by creating two identical tables, neither\n        having a primary key, the only difference being that the first\n        (table auto_0) is created with\n        sql_generate_invisible_primary_key set to\n        OFF, and the second\n        (auto_1) after setting it to\n        ON, as shown here:\n      ",
        "Press CTRL+C to copy mysql> SELECT @@sql_generate_invisible_primary_key;\n+--------------------------------------+\n| @@sql_generate_invisible_primary_key |\n+--------------------------------------+\n|                                    0 |\n+--------------------------------------+\n1 row in set (0.00 sec)\n\nmysql> CREATE TABLE auto_0 (c1 VARCHAR(50), c2 INT);\nQuery OK, 0 rows affected (0.02 sec)\n\nmysql> SET sql_generate_invisible_primary_key=ON;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> SELECT @@sql_generate_invisible_primary_key;\n+--------------------------------------+\n| @@sql_generate_invisible_primary_key |\n+--------------------------------------+\n|                                    1 |\n+--------------------------------------+\n1 row in set (0.00 sec)\n\nmysql> CREATE TABLE auto_1 (c1 VARCHAR(50), c2 INT);\nQuery OK, 0 rows affected (0.04 sec)",
        "\n        Compare the output of these SHOW CREATE\n        TABLE statements to see the difference in how the\n        tables were actually created:\n      ",
        "\n        Since auto_1 had no primary key specified by\n        the CREATE TABLE statement used to create it,\n        setting sql_generate_invisible_primary_key =\n        ON causes MySQL to add both the invisible column\n        my_row_id to this table and a primary key on\n        that column. Since\n        sql_generate_invisible_primary_key was\n        OFF at the time that\n        auto_0 was created, no such additions were\n        performed on that table.\n      ",
        "\n        When a primary key is added to a table by the server, the column\n        and key name is always my_row_id. For this\n        reason, when enabling generated invisible primary keys in this\n        way, you cannot create a table having a column named\n        my_row_id unless the table creation statement\n        also specifies an explicit primary key. (You are not required to\n        name the column or key my_row_id in such\n        cases.)\n      ",
        "\nmy_row_id is an invisible column, which means\n        it is not shown in the output of\n        SELECT * or\n        TABLE; the column must be\n        selected explicitly by name. See\n        Section\u00a015.1.20.10, \u201cInvisible Columns\u201d.\n      ",
        "\n        When GIPKs are enabled, a generated primary key cannot be\n        altered other than to switch it between\n        VISIBLE and INVISIBLE. To\n        make the generated invisible primary key on\n        auto_1 visible, execute this\n        ALTER TABLE statement:\n      ",
        "Press CTRL+C to copy mysql> ALTER TABLE auto_1 ALTER COLUMN my_row_id SET VISIBLE;\nQuery OK, 0 rows affected (0.02 sec)\nRecords: 0  Duplicates: 0  Warnings: 0\n\nmysql> SHOW CREATE TABLE auto_1\\G\n*************************** 1. row ***************************\n       Table: auto_1\nCreate Table: CREATE TABLE `auto_1` (\n  `my_row_id` bigint unsigned NOT NULL AUTO_INCREMENT,\n  `c1` varchar(50) DEFAULT NULL,\n  `c2` int DEFAULT NULL,\n  PRIMARY KEY (`my_row_id`)\n) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci\n1 row in set (0.01 sec)",
        "\n        To make this generated primary key invisible again, issue\n        ALTER TABLE auto_1 ALTER COLUMN my_row_id SET\n        INVISIBLE.\n      ",
        "\n        A generated invisible primary key is always invisible by\n        default.\n      ",
        "\n        Whenever GIPKs are enabled, you cannot drop a generated primary\n        key if either of the following 2 conditions would result:\n",
        "\n\n            The table is left with no primary key.\n          \n            The primary key is dropped, but not the primary key column.\n\n",
        "\n        The effects of\n        sql_generate_invisible_primary_key apply to\n        tables using the InnoDB storage engine only.\n        You can use an ALTER TABLE\n        statement to change the storage engine used by a table that has\n        a generated invisible primary key; in this case, the primary key\n        and column remain in place, but the table and key no longer\n        receive any special treatment.\n      ",
        "\n        By default, GIPKs are shown in the output of\n        SHOW CREATE TABLE,\n        SHOW COLUMNS, and\n        SHOW INDEX, and are visible in\n        the Information Schema COLUMNS and\n        STATISTICS tables. You can cause\n        generated invisible primary keys to be hidden instead in such\n        cases by setting the\n        show_gipk_in_create_table_and_information_schema\n        system variable to OFF. By default, this\n        variable is ON, as shown here:\n      ",
        "Press CTRL+C to copy mysql> SELECT @@show_gipk_in_create_table_and_information_schema;\n+----------------------------------------------------+\n| @@show_gipk_in_create_table_and_information_schema |\n+----------------------------------------------------+\n|                                                  1 |\n+----------------------------------------------------+\n1 row in set (0.00 sec)",
        "\n        As can be seen from the following query against the\n        COLUMNS table, my_row_id\n        is visible among the columns of auto_1:\n      ",
        "Press CTRL+C to copy mysql> SELECT COLUMN_NAME, ORDINAL_POSITION, DATA_TYPE, COLUMN_KEY\n    -> FROM INFORMATION_SCHEMA.COLUMNS\n    -> WHERE TABLE_NAME = \"auto_1\";\n+-------------+------------------+-----------+------------+\n| COLUMN_NAME | ORDINAL_POSITION | DATA_TYPE | COLUMN_KEY |\n+-------------+------------------+-----------+------------+\n| my_row_id   |                1 | bigint    | PRI        |\n| c1          |                2 | varchar   |            |\n| c2          |                3 | int       |            |\n+-------------+------------------+-----------+------------+\n3 rows in set (0.01 sec)",
        "\n        After\n        show_gipk_in_create_table_and_information_schema\n        is set to OFF, my_row_id\n        can no longer be seen in the COLUMNS table,\n        as shown here:\n      ",
        "Press CTRL+C to copy mysql> SET show_gipk_in_create_table_and_information_schema = OFF;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> SELECT @@show_gipk_in_create_table_and_information_schema;\n+----------------------------------------------------+\n| @@show_gipk_in_create_table_and_information_schema |\n+----------------------------------------------------+\n|                                                  0 |\n+----------------------------------------------------+\n1 row in set (0.00 sec)\n\nmysql> SELECT COLUMN_NAME, ORDINAL_POSITION, DATA_TYPE, COLUMN_KEY\n    -> FROM INFORMATION_SCHEMA.COLUMNS\n    -> WHERE TABLE_NAME = \"auto_1\";\n+-------------+------------------+-----------+------------+\n| COLUMN_NAME | ORDINAL_POSITION | DATA_TYPE | COLUMN_KEY |\n+-------------+------------------+-----------+------------+\n| c1          |                2 | varchar   |            |\n| c2          |                3 | int       |            |\n+-------------+------------------+-----------+------------+\n2 rows in set (0.00 sec)",
        "\n        The setting for\n        sql_generate_invisible_primary_key is not\n        replicated, and is ignored by replication applier threads. This\n        means that the setting of this variable on the source has no\n        effect on the replica. You can cause the replica to add a GIPK\n        for tables replicated without primary keys on a given\n        replication channel using\n        REQUIRE_TABLE_PRIMARY_KEY_CHECK = GENERATE as\n        part of a\n        CHANGE\n        REPLICATION SOURCE TO statement.\n      ",
        "\n        GIPKs work with row-based replication of\n        CREATE\n        TABLE ... SELECT; the information written to the\n        binary log for this statement in such cases includes the GIPK\n        definition, and thus is replicated correctly. Statement-based\n        replication of CREATE TABLE ... SELECT is not\n        supported with sql_generate_invisible_primary_key =\n        ON.\n      ",
        "\n        When creating or importing backups of installations where GIPKs\n        are in use, it is possible to exclude generated invisible\n        primary key columns and values. The\n        --skip-generated-invisible-primary-key\n        option for mysqldump causes GIPK information\n        to be excluded in the program's output.\n"
    ],
    "Examples": [
        "mysql> SELECT @@sql_generate_invisible_primary_key;\n+--------------------------------------+\n| @@sql_generate_invisible_primary_key |\n+--------------------------------------+\n|                                    0 |\n+--------------------------------------+\n1 row in set (0.00 sec)\n\nmysql> CREATE TABLE auto_0 (c1 VARCHAR(50), c2 INT);\nQuery OK, 0 rows affected (0.02 sec)\n\nmysql> SET sql_generate_invisible_primary_key=ON;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> SELECT @@sql_generate_invisible_primary_key;\n+--------------------------------------+\n| @@sql_generate_invisible_primary_key |\n+--------------------------------------+\n|                                    1 |\n+--------------------------------------+\n1 row in set (0.00 sec)\n\nmysql> CREATE TABLE auto_1 (c1 VARCHAR(50), c2 INT);\nQuery OK, 0 rows affected (0.04 sec)",
        "mysql> ALTER TABLE auto_1 ALTER COLUMN my_row_id SET VISIBLE;\nQuery OK, 0 rows affected (0.02 sec)\nRecords: 0  Duplicates: 0  Warnings: 0\n\nmysql> SHOW CREATE TABLE auto_1\\G\n*************************** 1. row ***************************\n       Table: auto_1\nCreate Table: CREATE TABLE `auto_1` (\n  `my_row_id` bigint unsigned NOT NULL AUTO_INCREMENT,\n  `c1` varchar(50) DEFAULT NULL,\n  `c2` int DEFAULT NULL,\n  PRIMARY KEY (`my_row_id`)\n) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci\n1 row in set (0.01 sec)",
        "mysql> SELECT @@show_gipk_in_create_table_and_information_schema;\n+----------------------------------------------------+\n| @@show_gipk_in_create_table_and_information_schema |\n+----------------------------------------------------+\n|                                                  1 |\n+----------------------------------------------------+\n1 row in set (0.00 sec)",
        "mysql> SELECT COLUMN_NAME, ORDINAL_POSITION, DATA_TYPE, COLUMN_KEY\n    -> FROM INFORMATION_SCHEMA.COLUMNS\n    -> WHERE TABLE_NAME = \"auto_1\";\n+-------------+------------------+-----------+------------+\n| COLUMN_NAME | ORDINAL_POSITION | DATA_TYPE | COLUMN_KEY |\n+-------------+------------------+-----------+------------+\n| my_row_id   |                1 | bigint    | PRI        |\n| c1          |                2 | varchar   |            |\n| c2          |                3 | int       |            |\n+-------------+------------------+-----------+------------+\n3 rows in set (0.01 sec)",
        "mysql> SET show_gipk_in_create_table_and_information_schema = OFF;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> SELECT @@show_gipk_in_create_table_and_information_schema;\n+----------------------------------------------------+\n| @@show_gipk_in_create_table_and_information_schema |\n+----------------------------------------------------+\n|                                                  0 |\n+----------------------------------------------------+\n1 row in set (0.00 sec)\n\nmysql> SELECT COLUMN_NAME, ORDINAL_POSITION, DATA_TYPE, COLUMN_KEY\n    -> FROM INFORMATION_SCHEMA.COLUMNS\n    -> WHERE TABLE_NAME = \"auto_1\";\n+-------------+------------------+-----------+------------+\n| COLUMN_NAME | ORDINAL_POSITION | DATA_TYPE | COLUMN_KEY |\n+-------------+------------------+-----------+------------+\n| c1          |                2 | varchar   |            |\n| c2          |                3 | int       |            |\n+-------------+------------------+-----------+------------+\n2 rows in set (0.00 sec)"
    ],
    "Category": [
        "Data Definition Statements"
    ]
}